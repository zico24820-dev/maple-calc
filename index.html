<!DOCTYPE html>
<html lang="ko">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7732517218301279" crossorigin="anonymous">
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ì´í”Œ í‚¤ìš°ê¸° ê³„ì‚°ê¸° (TalkView Edition)</title>

    <script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.amplitude.com/script/26b78d7a4668f9cff4a4270923e264b3.js"></script>
<script>
window.amplitude.add(window.sessionReplay.plugin({sampleRate: 1}));
window.amplitude.init('26b78d7a4668f9cff4a4270923e264b3', {"fetchRemoteConfig":true,"autocapture":{"attribution":true,"fileDownloads":true,"formInteractions":true,"pageViews":true,"sessions":true,"elementInteractions":true,"networkTracking":true,"webVitals":true,"frustrationInteractions":{"errorClicks":true,"deadClicks":true,"rageClicks":true}}});</script>
    <style>
        body { background-color: #1a1b1e; color: #e5e7eb; font-family: 'Apple SD Gothic Neo', sans-serif; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .input-box { background-color: #25262b; border: 1px solid #373a40; color: white; transition: 0.2s; }
        .input-box:focus { border-color: #4dabf7; outline: none; }
        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }
        .notice-bar { animation: slideDown 0.5s ease-out; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #4dabf7; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background-color: #2C2E33; }
        .diff-tag { font-size: 10px; font-weight: bold; margin-right: 4px; }
        .diff-plus { color: #40c057; }
        .diff-minus { color: #fa5252; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center">

    <div id="global-tooltip" class="fixed hidden bg-black/95 text-white text-xs p-2.5 rounded-lg shadow-2xl z-[9999] max-w-[220px] pointer-events-none leading-relaxed border border-gray-600 backdrop-blur-sm">
    </div>

    <div class="w-full flex justify-center">
        <a id="banner-link" href="https://forum.nexon.com/maplestoryidle-kr/board_list?board=6697" target="_blank" class="w-full max-w-5xl hover:opacity-90 transition hidden">
            <img id="banner-img" src="" alt="ê³µì§€ ë°°ë„ˆ" class="rounded-b-xl shadow-lg" style="width: 100%; max-width: 500px; height: auto; display: block; margin: 0 auto;">
        </a>
    </div>

    <div id="notice-container" class="w-full bg-blue-600 text-white text-sm text-center py-2 hidden notice-bar shadow-md z-10">
        <span class="font-bold">ğŸ“¢ NOTICE:</span> <span id="notice-msg">ë¡œë”©ì¤‘...</span>
    </div>

    <div class="w-full max-w-5xl bg-[#2C2E33] rounded-xl shadow-2xl border border-[#373A40] overflow-hidden mt-4 md:mt-8">
        
        <header class="bg-[#25262B] p-5 border-b border-[#373A40] flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold flex items-center gap-2 text-white">
                    âš”ï¸ ë©”ì´í”Œ í‚¤ìš°ê¸° ìŠ¤í™ ê³„ì‚°ê¸°
                    <span class="text-[10px] bg-gray-700 px-1.5 py-0.5 rounded text-gray-300 border border-gray-600">v<span id="app-ver">loading</span></span>
                </h1>
            </div>
            <div class="flex gap-4 text-xs text-gray-400">
                <button onclick="resetAllData()" class="hover:text-red-400 underline">ì „ì²´ ì´ˆê¸°í™”</button>
                <span id="save-status" class="text-green-500">ìë™ì €ì¥ ON</span>
            </div>
        </header>

        <div class="px-6 pt-4">
            <details class="bg-[#1A1B1E] border border-[#373A40] rounded-lg overflow-hidden group">
                <summary class="flex items-center justify-between p-3 cursor-pointer select-none text-gray-400 hover:text-white transition">
                    <span class="text-xs font-bold flex items-center gap-2">
                        ğŸ’¡ ì²˜ìŒì´ì‹ ê°€ìš”? <span class="text-[#4dabf7]">ì‚¬ìš©ë²• ë³´ê¸°</span>
                    </span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform group-open:rotate-180 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </summary>
                <div class="p-4 border-t border-[#373A40] text-xs text-gray-300 leading-relaxed bg-[#141517]">
                    <ol class="list-decimal pl-4 space-y-2">
                        <li><strong class="text-yellow-500">ì „íˆ¬ ì„¤ì •:</strong> ì‚¬ìš©í•˜ëŠ” ìŠ¤í‚¬ì˜ ê³„ìˆ˜ì™€ íƒ€ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</li>
                        <li><strong class="text-[#4dabf7]">ë‚´ ìŠ¤í…Ÿì°½:</strong> ìŠ¤í…Ÿì„ ì…ë ¥í•˜ë©´ <span class="text-red-400 font-bold">ğŸ”¥ë¶€ì¡±</span> ë±ƒì§€ë¡œ ê°€ì¥ ì‹œê¸‰í•œ ìŠ¤íƒ¯ì„ ì•Œë ¤ì¤ë‹ˆë‹¤.</li>
                        <li><strong class="text-blue-300">ì•„ì´í…œ ë¹„êµ:</strong> ì•„ì´í…œ ë³€ê²½ ì‹œ ë°ë¯¸ì§€ ë³€í™”ë¥¼ í™•ì¸í•˜ì„¸ìš”.</li>
                        <li><strong class="text-red-400">ì£¼ì˜:</strong> í¬í™•ì´ 100%ê°€ ì•ˆ ë˜ë©´ ë”œ ì†ì‹¤ì´ í½ë‹ˆë‹¤. <span class="text-red-400 font-bold">ğŸ¯í•„ìˆ˜</span> ë±ƒì§€ê°€ ëœ¨ë©´ ìš°ì„ ì ìœ¼ë¡œ ë§ì¶”ì„¸ìš”.</li>
                    </ol>
                </div>
            </details>
        </div>

        <div class="p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-3 bg-[#1A1B1E] p-4 rounded-lg border border-[#373A40] flex flex-col h-[680px]">
                
                <div class="mb-4 pb-4 border-b border-gray-700">
                    <h2 class="font-bold text-yellow-500 mb-2 text-sm flex items-center gap-1">
                        âš¡ ì „íˆ¬/ìŠ¤í‚¬ ì„¤ì •
                        <div class="cursor-help" onmouseenter="showTooltip(event, 'ìŠ¤í‚¬ì˜ í¼ì„¼íŠ¸ ë°ë¯¸ì§€ì™€ íƒ€ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.')" onmouseleave="hideTooltip()">
                             <span class="text-[10px] text-gray-500 border border-gray-500 rounded-full w-3 h-3 flex items-center justify-center">?</span>
                        </div>
                    </h2>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <span class="text-[10px] text-gray-400">ìŠ¤í‚¬ ê³„ìˆ˜(%)</span>
                            <input type="number" id="skill-percent" value="100" class="input-box w-full rounded px-2 py-1 text-right text-xs" oninput="saveExtraSettings()">
                        </div>
                        <div>
                            <span class="text-[10px] text-gray-400">íƒ€ìˆ˜</span>
                            <input type="number" id="skill-hit" value="1" class="input-box w-full rounded px-2 py-1 text-right text-xs" oninput="saveExtraSettings()">
                        </div>
                    </div>
                </div>

                <h2 class="font-bold text-[#4dabf7] mb-2 text-sm">ğŸ“Š ë‚´ ìŠ¤í…Ÿì°½ (ê¸°ë³¸)</h2>
                <div id="base-inputs" class="space-y-2 flex-1 overflow-y-auto pr-2 custom-scrollbar"></div>
            </div>

            <div class="lg:col-span-9 flex flex-col gap-4">
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-4 h-full">
                    <div class="bg-[#141517] p-4 rounded-lg border border-blue-900/30 flex flex-col relative group h-[680px]">
                        <button onclick="resetItem('A')" class="absolute top-4 right-4 text-[10px] text-gray-500 hover:text-blue-300 border border-gray-700 rounded px-2 py-1 transition">â†º ì´ˆê¸°í™”</button>
                        <div class="text-center mb-4 pb-2 border-b border-gray-800">
                            <span class="bg-blue-900 text-blue-200 text-xs font-bold px-3 py-1 rounded-full">ì°©ìš©í…œ (Left)</span>
                        </div>
                        <div id="itemA-inputs" class="space-y-2 flex-1 overflow-y-auto pr-2 custom-scrollbar"></div>
                    </div>

                    <div class="bg-[#141517] p-4 rounded-lg border border-red-900/30 flex flex-col relative group h-[680px]">
                        <button onclick="resetItem('B')" class="absolute top-4 right-4 text-[10px] text-gray-500 hover:text-red-300 border border-gray-700 rounded px-2 py-1 transition">â†º ì´ˆê¸°í™”</button>
                        <div class="text-center mb-4 pb-2 border-b border-gray-800">
                            <span class="bg-red-900 text-red-200 text-xs font-bold px-3 py-1 rounded-full">ë°”ê¿€í…œ (Right)</span>
                        </div>
                        <div id="itemB-inputs" class="space-y-2 flex-1 overflow-y-auto pr-2 custom-scrollbar"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-[#101113] p-6 border-t border-[#373A40]">
            <div class="grid grid-cols-2 gap-8 divide-x divide-gray-800">
                <div class="text-center">
                    <div class="text-xs text-gray-400 mb-1 font-bold">â±ï¸ ì¼ë°˜ ëª¬ìŠ¤í„° í‰ê·  ë°ë¯¸ì§€</div>
                    <div class="text-xs text-gray-500 mb-2">
                        <span id="res-normal-prev">0</span> â†’ <span id="res-normal-next" class="text-gray-300">0</span>
                    </div>
                    <div id="res-normal-diff" class="text-4xl font-mono font-bold text-gray-500">0.00%</div>
                </div>
                <div class="text-center">
                    <div class="text-xs text-yellow-500 mb-1 font-bold">ğŸ”¥ ë³´ìŠ¤ ëª¬ìŠ¤í„° í‰ê·  ë°ë¯¸ì§€</div>
                    <div class="text-xs text-gray-500 mb-2">
                        <span id="res-boss-prev">0</span> â†’ <span id="res-boss-next" class="text-gray-300">0</span>
                    </div>
                    <div id="res-boss-diff" class="text-5xl font-mono font-bold text-gray-500">0.00%</div>
                </div>
            </div>
            <p class="text-[10px] text-gray-600 mt-4 text-center leading-relaxed">
                * í•´ë‹¹ ë°ë¯¸ì§€ëŠ” ëª¬ìŠ¤í„°ì˜ ë°©ì–´ë ¥ ë° ê¸°íƒ€ ë³€ìˆ˜ì— ë”°ë¼ ì‹¤ì œì™€ ì°¨ì´ê°€ ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                ë‹¨ìˆœ ì•„ì´í…œ/ìŠ¤íƒ¯ ë¹„êµ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.
            </p>
        </div>
    </div>

    <div class="w-full max-w-5xl mt-6 px-1 mb-10">
        <div class="bg-[#1A1B1E] border border-[#373A40] rounded-xl p-4 flex flex-col md:flex-row justify-between items-center gap-4 shadow-lg">
            <div class="flex items-center gap-3 w-full md:w-auto">
                <div class="p-2 bg-blue-900/30 rounded-lg text-blue-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                </div>
                <div class="text-left">
                    <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Total Users</p>
                    <p id="dash-total" class="text-xl font-bold text-white font-mono">-</p>
                </div>
            </div>
            <div class="h-8 w-[1px] bg-gray-700 hidden md:block"></div>
            <div class="flex items-center gap-3 w-full md:w-auto">
                <div class="p-2 bg-green-900/30 rounded-lg text-green-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                </div>
                <div class="text-left">
                    <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Today Visitors</p>
                    <p id="dash-today" class="text-xl font-bold text-white font-mono">-</p>
                </div>
            </div>
            <div class="h-8 w-[1px] bg-gray-700 hidden md:block"></div>
            <div class="flex items-center gap-3 w-full md:w-auto">
                 <div class="p-2 bg-gray-700/30 rounded-lg text-gray-400" id="status-icon-bg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" /></svg>
                </div>
                <div class="text-left">
                    <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Service Status</p>
                    <p id="status-text" class="text-sm font-bold text-gray-500">ğŸ”´ Offline</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="mb-4 text-center text-gray-500 text-xs">
        <p class="font-bold mb-1">Created by <span id="footer-maker" class="text-gray-300">í†¡ë·°</span></p>
        <p>ë¬¸ì˜: <a href="#" id="footer-email" class="hover:text-[#4dabf7] underline">zico24820@gmail.com</a></p>
        <p class="mt-2 text-[10px] text-gray-600">Copyright Â© 2026 TalkView. All rights reserved.</p>
    </footer>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbz8ePLqx1LM7tDmIXWC1Opv6V5IY76_zWScveWl0NsVIgUpypFNNbjLLFuJDA6f2AZ9/exec";
        const APP_VERSION = "8.6(Fix)"; 

        document.getElementById('app-ver').innerText = APP_VERSION;

        const fields = [
            { key: 'atk', label: 'ê³µê²©ë ¥' },
            { key: 'atkSpeed', label: 'ê³µê²©ì†ë„%' },
            { key: 'damage', label: 'ë°ë¯¸ì§€%' },
            { key: 'minMaxDmg', label: 'ìµœì†Œ+ìµœëŒ€', desc: 'ë§ˆì§€ë§‰ì— 2ë¡œ ë‚˜ëˆ„ì–´ ê³„ì‚°ë©ë‹ˆë‹¤.'}, 
            { key: 'bossDamage', label: 'ë³´ê³µ%' },
            { key: 'normalDamage', label: 'ì¼ë°˜ë€%'},
            { key: 'critRate', label: 'í¬í™•%', desc: 'ìµœëŒ€ 100%ê¹Œì§€ ì ìš©ë©ë‹ˆë‹¤.' },

            { key: 'critDmg', label: 'í¬ë¦¬ë°ë¯¸ì§€%' },
            { key: 'statPercent', label: 'ìŠ¤í…Ÿë¹„ë¡€ë°ë¯¸ì§€%' },
            { key: 'flatMainStat', label: 'ì£¼ìŠ¤í…Ÿ(ì¼ë°˜)' },
            { key: 'finalDmg', label: 'ìµœì¢…ë€%', desc: 'ìµœì¢…ì ìœ¼ë¡œ ê³±í•´ì§€ëŠ” ë°ë¯¸ì§€ì…ë‹ˆë‹¤.' }, 
            { key: 'ampDmg', label: 'ì¦í­%', desc: 'ìµœì¢… ë°ë¯¸ì§€ì™€ ë³„ê°œë¡œ ê³±ì—°ì‚°ë˜ëŠ” í¬ê·€ ìŠ¤íƒ¯ì…ë‹ˆë‹¤.' }
        ];

        let baseStats = JSON.parse(localStorage.getItem('myBaseStats_v3')) || {};
        let extraSettings = JSON.parse(localStorage.getItem('myExtraSettings')) || { skillPercent: 100, skillHit: 1 };
        let itemA = {};
        let itemB = {};

        const skillPerInput = document.getElementById('skill-percent');
        const skillHitInput = document.getElementById('skill-hit');
        
        if(skillPerInput) skillPerInput.value = extraSettings.skillPercent || 100;
        if(skillHitInput) skillHitInput.value = extraSettings.skillHit || 1;

        // â–¼â–¼â–¼ íš¨ìœ¨ ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜ (ë‰´ë¹„ ë³´í˜¸ ëª¨ë“œ) â–¼â–¼â–¼
        function analyzeEfficiency(baseStats) {
            fields.forEach(f => {
                const el = document.getElementById(`badge-${f.key}`);
                if(el) { el.innerText = ''; el.className = 'hidden'; }
            });

            // 1. í¬í™• 100% ë¯¸ë§Œ ì²´í¬ (ê°€ì¥ ë¨¼ì € ì‹¤í–‰)
            // ë‰´ë¹„ ì ˆë‹¨ê¸° ë°©ì§€: ìˆ˜í•™ì  íš¨ìœ¨ ë¬´ì‹œí•˜ê³  ë¬´ì¡°ê±´ í•„ìˆ˜ ë±ƒì§€ ë¶€ì°©
            const currentCritRate = baseStats.critRate || 0;
            if (currentCritRate < 100) {
                setBadge('critRate', 'ğŸ¯í•„ìˆ˜', 'text-red-400 border-red-500 animate-pulse');
                // í¬í™•ì€ ì´ì œ 'í•„ìˆ˜' ë±ƒì§€ë¥¼ ë°›ì•˜ìœ¼ë¯€ë¡œ ì•„ë˜ ìˆœìœ„ ê²½ìŸì—ì„œ ì œì™¸ë¨
            }

            // 2. ê¸°ì¤€ ì ìˆ˜ ê³„ì‚° (ê³µê²©ë ¥ ì—†ì–´ë„ ê³„ì‚°ë˜ê²Œ true ì„¤ì •)
            const baseScoreObj = getSimpleDpm(baseStats, true); 
            if(baseScoreObj.boss === 0 && baseScoreObj.normal === 0) return;

            const increaseAmount = 10; 
            
            // 3. ë¹„êµ ëŒ€ìƒ (í¬í™•ì€ ìœ„ì—ì„œ ì²˜ë¦¬í–ˆìœ¼ë¯€ë¡œ ì œì™¸í•  ìˆ˜ë„ ìˆì§€ë§Œ, 
            // 100% ë¯¸ë§Œì¼ ë•Œ 'í•„ìˆ˜'ë‘ '1ìœ„'ê°€ ê²¹ì¹˜ì§€ ì•Šê²Œ í•˜ê¸° ìœ„í•´
            // ì—¬ê¸°ì„œëŠ” í¬í™•ì„ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ë¼ë¦¬ ìˆœìœ„ë¥¼ ë§¤ê¹ë‹ˆë‹¤.)
            const efficiencies = [
                { key: 'damage', label: 'ë°ë¯¸ì§€', gain: getGain(baseStats, 'damage', increaseAmount) },
                { key: 'minMaxDmg', label: 'ìµœì†ŒìµœëŒ€', gain: getGain(baseStats, 'minMaxDmg', increaseAmount) },
                { key: 'bossDamage', label: 'ë³´ê³µ', gain: getGain(baseStats, 'bossDamage', increaseAmount) },
                { key: 'normalDamage', label: 'ì¼ë°˜ë€', gain: getGain(baseStats, 'normalDamage', increaseAmount) },
                // í¬í™•ì€ ì´ë¯¸ 'í•„ìˆ˜' íŒì •ì„ ë°›ì•˜ìœ¼ë©´ ì—¬ê¸°ì„œ ëºë‹ˆë‹¤. 
                // ë§Œì•½ 100%ë¼ë©´? ì–´ì°¨í”¼ íš¨ìœ¨ 0ì´ë¼ì„œ ê¼´ì°Œë¡œ ê°ˆ í…Œë‹ˆ ìƒê´€ ì—†ìŒ.
                // { key: 'critRate', ... } -> ì œì™¸ (ìœ„ì—ì„œ ì²˜ë¦¬)
                { key: 'critDmg', label: 'í¬ë¦¬ë€', gain: getGain(baseStats, 'critDmg', increaseAmount) },
                { key: 'statPercent', label: 'ìŠ¤í…Ÿë¹„ë¡€', gain: getGain(baseStats, 'statPercent', increaseAmount) }
            ];

            // 4. íš¨ìœ¨ ë†’ì€ ìˆœ ì •ë ¬
            const sorted = efficiencies.sort((a, b) => b.gain - a.gain);

            if (sorted.length > 0) {
                // 1ìœ„: ê°€ì¥ ê¸‰í•¨
                const rank1 = sorted[0];
                if(rank1.gain > 0) setBadge(rank1.key, `ğŸ”¥ë¶€ì¡±`, 'text-red-400 border-red-500 animate-pulse');
                
                // 2ìœ„: ì¢‹ìŒ
                const rank2 = sorted[1];
                if(rank2 && rank2.gain > 0) setBadge(rank2.key, `âœ¨ë‚˜ì´ìŠ¤`, 'text-purple-400 border-purple-500');

                // 3ìœ„: ì¤€ìˆ˜í•¨
                const rank3 = sorted[2];
                if(rank3 && rank3.gain > 0) setBadge(rank3.key, `ğŸ‘êµ¿`, 'text-green-400 border-green-500');

                // ê¼´ì°Œ: ê³¼ë‹¤ (íš¨ìœ¨ì´ 1ë“±ì˜ ì ˆë°˜ë„ ì•ˆ ë‚˜ì˜¤ë©´)
                const worst = sorted[sorted.length - 1];
                if(worst && worst.gain > 0 && worst.gain < rank1.gain * 0.5) {
                     setBadge(worst.key, `ğŸ“‰ê³¼ë‹¤`, 'text-gray-500 border-gray-500');
                }
            }
        }

        function getGain(stats, key, amount) {
            const tempStats = { ...stats };
            tempStats[key] = (tempStats[key] || 0) + amount;
            
            const beforeObj = getSimpleDpm(stats, true);
            const afterObj = getSimpleDpm(tempStats, true);
            
            let normalGain = 0;
            if (beforeObj.normal > 0) {
                normalGain = ((afterObj.normal - beforeObj.normal) / beforeObj.normal) * 100;
            }

            let bossGain = 0;
            if (beforeObj.boss > 0) {
                bossGain = ((afterObj.boss - beforeObj.boss) / beforeObj.boss) * 100;
            }

            return Math.max(normalGain, bossGain);
        }

        function getSimpleDpm(stats, forceSafeAtk = false) {
            let atk = stats.atk || 0;
            if (forceSafeAtk && atk === 0) atk = 1;

            const minMaxAvg = (stats.minMaxDmg || 0) / 2;
            const totalDmgPercent = (stats.damage || 0) + minMaxAvg;
            
            const dmgMult = 1 + (totalDmgPercent / 100);
            
            const critRate = Math.min((stats.critRate || 0), 100);
            const critDmg = stats.critDmg || 0;
            const critMult = 1 + ((critRate / 100) * (critDmg / 100));

            const atkSpeed = Math.min((stats.atkSpeed || 0), 150);
            const atkSpeedMult = 1 + (atkSpeed / 100);

            const normalMult = 1 + ((stats.normalDamage || 0) / 100);
            const bossMult = 1 + ((stats.bossDamage || 0) / 100);
            
            const finalMult = 1 + ((stats.finalDmg || 0) / 100);
            const ampMult = 1 + ((stats.ampDmg || 0) / 100);
            
            const statMult = 1 + ((stats.statPercent || 0) / 100);

            const baseDmg = atk * dmgMult * critMult * finalMult * ampMult * statMult;
            const dps = baseDmg * atkSpeedMult;

            return { 
                normal: dps * normalMult, 
                boss: dps * bossMult,
                rawNormal: baseDmg * normalMult,
                rawBoss: baseDmg * bossMult
            };
        }

   // â–¼ ê¸°ì¡´ setBadge í•¨ìˆ˜ë¥¼ ì°¾ì•„ì„œ ì´ê±¸ë¡œ ë®ì–´ì”Œìš°ì„¸ìš” â–¼
function setBadge(key, text, colorClass) {
    const el = document.getElementById(`badge-${key}`);
    if(el) {
        el.innerText = text;
        // í…Œì¼ìœˆë“œ í´ë˜ìŠ¤ ì¤‘ë³µ ë°©ì§€ ë° ì´ˆìŠ¬ë¦¼ ìŠ¤íƒ€ì¼ ì ìš©
        // ê¸°ì¡´ colorClassì—ì„œ í°íŠ¸ í¬ê¸° ê´€ë ¨ í´ë˜ìŠ¤ëŠ” ì œê±°í•©ë‹ˆë‹¤.
        let cleanedColorClass = colorClass
            .replace(/text-\[.*?\]/g, '')
            .replace(/text-xs/g, '')
            .replace(/text-sm/g, '')
            .replace(/font-bold/g, '')
            .replace(/border/g, '')
            .replace(/px-1/g, '')
            .replace(/rounded/g, '')
            .replace(/whitespace-nowrap/g, '');
            
        el.className = `shrink-0 ml-0.5 text-[9px] font-bold border px-[3px] rounded-sm whitespace-nowrap ${cleanedColorClass}`;
        el.classList.remove('hidden');
    }
}

        function showTooltip(event, text) {
            const tooltip = document.getElementById('global-tooltip');
            if(!tooltip || !text) return;
            tooltip.innerHTML = text;
            tooltip.classList.remove('hidden');
            const x = event.clientX;
            const y = event.clientY;
            if (x > window.innerWidth - 220) {
                tooltip.style.left = (x - 210) + 'px';
            } else {
                tooltip.style.left = (x + 15) + 'px';
            }
            tooltip.style.top = (y + 15) + 'px';
        }

        function hideTooltip() {
            const tooltip = document.getElementById('global-tooltip');
            if(tooltip) tooltip.classList.add('hidden');
        }

        async function loadSystemInfo() {
            const statusText = document.getElementById('status-text');
            const statusBg = document.getElementById('status-icon-bg');
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000);
                const res = await fetch(API_URL + "?t=" + new Date().getTime(), { signal: controller.signal });
                clearTimeout(timeoutId);
                const json = await res.json();
                const sys = json.system || {};

                if (sys.notice) {
                    const noticeEl = document.getElementById('notice-msg');
                    const noticeCon = document.getElementById('notice-container');
                    if(noticeEl && noticeCon) {
                        noticeEl.innerText = sys.notice;
                        noticeCon.classList.remove('hidden');
                    }
                }
                
                if (sys.banner_img) {
                    const bannerLink = document.getElementById('banner-link');
                    const bannerImg = document.getElementById('banner-img');
                    if(bannerImg) {
                        let imgUrl = sys.banner_img;
                        if (imgUrl.includes('drive.google.com')) {
                            const idMatch = imgUrl.match(/\/d\/(.+?)\//);
                            if (idMatch) imgUrl = `https://drive.google.com/uc?export=view&id=${idMatch[1]}`;
                        }
                        bannerImg.src = imgUrl;
                        if(bannerLink) {
                            bannerLink.classList.remove('hidden');
                            if(sys.banner_link) bannerLink.href = sys.banner_link;
                        }
                    }
                }

                if (sys.totalViews) animateValue("dash-total", 0, sys.totalViews, 1500);
                if (sys.todayViews) animateValue("dash-today", 0, sys.todayViews, 1500);

                if(statusText) {
                    statusText.innerText = "ğŸŸ¢ Online";
                    statusText.classList.replace("text-gray-500", "text-green-400");
                }
                if(statusBg) {
                    statusBg.classList.replace("bg-gray-700/30", "bg-purple-900/30");
                    statusBg.classList.replace("text-gray-400", "text-purple-400");
                    statusBg.classList.add("animate-pulse");
                }

            } catch (err) { 
                console.log("DB ì—°ê²° ì‹¤íŒ¨ (ì˜¤í”„ë¼ì¸ ëª¨ë“œ):", err); 
            }
        }

        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            if(!obj) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

     function renderInputs() {
            const baseContainer = document.getElementById('base-inputs');
            const itemAContainer = document.getElementById('itemA-inputs');
            const itemBContainer = document.getElementById('itemB-inputs');
            if(!baseContainer) return;

            baseContainer.innerHTML = ''; itemAContainer.innerHTML = ''; itemBContainer.innerHTML = '';

            fields.forEach(f => {
                let tooltipHtml = '';
                if (f.desc) {
                    const safeDesc = f.desc.replace(/"/g, "&quot;");
                    // íˆ´íŒ ì•„ì´ì½˜ë„ í¬ê¸°ë¥¼ ì¤„ì´ê³ (w-3 h-3 -> w-2.5 h-2.5) ê°„ê²©ì„ ì¢í˜
                    tooltipHtml = `
                    <div class="ml-0.5 cursor-help shrink-0" 
                         onmouseenter="showTooltip(event, '${safeDesc}')" 
                         onmouseleave="hideTooltip()">
                        <span class="text-[9px] text-gray-500 border border-gray-500 rounded-full w-2.5 h-2.5 flex items-center justify-center hover:text-white hover:border-white transition">?</span>
                    </div>`;
                }

                // ë±ƒì§€ ìŠ¤íƒ€ì¼: ê°„ê²©ì„ ìµœì†Œí™”(ml-0.5)í•˜ê³  í°íŠ¸ í¬ê¸° ê³ ì •(text-[9px])
                const badgeHtml = `<span id="badge-${f.key}" class="hidden shrink-0 ml-0.5 text-[9px] font-bold border px-0.5 rounded whitespace-nowrap"></span>`;

                // âœ¨ ë””ìì¸ í•µì‹¬ ë³€ê²½ì  âœ¨
                // 1. wrapperClass: h-8(ë†’ì´ ê³ ì •), px-1.5 py-0.5(ì—¬ë°± ìµœì†Œí™”), mb-0.5(í•­ëª© ê°„ ê°„ê²© ì¶•ì†Œ)
                // 2. labelTextClass: text-[11px](í°íŠ¸ ì¶•ì†Œ), whitespace-nowrap(ì ˆëŒ€ ì¤„ë°”ê¿ˆ ê¸ˆì§€!)
                // 3. inputClass: h-6(ì…ë ¥ì°½ ë†’ì´ ì¶•ì†Œ), w-16(ë„ˆë¹„ ì•½ê°„ ì¶•ì†Œ), text-[11px](í°íŠ¸ ì¶•ì†Œ)
                
                const wrapperClass = "flex justify-between items-center bg-[#25262b] hover:bg-[#2C2E33] border border-[#373a40] rounded px-1.5 py-0.5 mb-0.5 transition group h-7";
                const labelRowClass = "flex items-center overflow-hidden flex-grow gap-0.5 mr-1"; // ë¼ë²¨ ì˜ì—­
                const labelTextClass = "text-[11px] text-gray-400 font-medium group-hover:text-white transition whitespace-nowrap"; 
                
                // ì…ë ¥ì°½ì„ ë” ì‘ê³  ìŠ¬ë¦¼í•˜ê²Œ ë§Œë“¦
                const inputClass = "input-box w-[68px] h-6 rounded px-1 text-right text-[11px] font-bold border-gray-600 bg-[#1A1B1E] text-white shrink-0 focus:ring-1 focus:ring-blue-500";

                // â–¼ [ë‚´ ìŠ¤í…Ÿì°½]
                baseContainer.innerHTML += `
                    <div class="${wrapperClass}">
                        <div class="${labelRowClass}"> 
                            <span class="${labelTextClass}">${f.label}</span>
                            ${tooltipHtml}
                            ${badgeHtml}
                        </div>
                        <input type="number" value="${baseStats[f.key] || ''}" placeholder="0"
                            oninput="updateBase('${f.key}', this.value)"
                            class="${inputClass}">
                    </div>`;
                
                // â–¼ [ì°©ìš©í…œ]
                itemAContainer.innerHTML += `
                    <div class="${wrapperClass}">
                        <div class="${labelRowClass}"> 
                            <span class="${labelTextClass}">${f.label}</span>
                            ${tooltipHtml}
                        </div>
                        <input type="number" id="input-A-${f.key}" placeholder="-" 
                            oninput="updateItem('A', '${f.key}', this.value)"
                            class="${inputClass}">
                    </div>`;

                // â–¼ [ë°”ê¿€í…œ]
                itemBContainer.innerHTML += `
                    <div class="${wrapperClass}">
                        <div class="${labelRowClass}">
                            <span class="${labelTextClass}">${f.label}</span>
                            ${tooltipHtml}
                            <span id="diff-tag-${f.key}" class="diff-tag ml-0.5 shrink-0 text-[9px]"></span>
                        </div>
                        <input type="number" id="input-B-${f.key}" placeholder="-" 
                            oninput="updateItem('B', '${f.key}', this.value)"
                            class="${inputClass} focus:ring-red-500">
                    </div>`;
            });
            
            // ë±ƒì§€ ìŠ¤íƒ€ì¼ì„ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì§ì ‘ ì£¼ì…í•˜ë¯€ë¡œ ê¸°ì¡´ setBadge í•¨ìˆ˜ë„ ìˆ˜ì • í•„ìš”
            // (ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ì•„ë˜ í•¨ìˆ˜ë¡œ êµì²´í•´ì£¼ì„¸ìš”)
            window.setBadge = function(key, text, colorClass) {
                const el = document.getElementById(`badge-${key}`);
                if(el) {
                    el.innerText = text;
                    // ê¸°ì¡´ colorClassì—ì„œ text-size ê´€ë ¨ í´ë˜ìŠ¤ê°€ ìˆë‹¤ë©´ ì œê±°í•˜ê³  ìš°ë¦¬ê°€ ì •í•œ í¬ê¸° ì‚¬ìš©
                    let finalColorClass = colorClass.replace(/text-\[.*?\]/g, '').replace(/text-xs/g, '').replace(/text-sm/g, '');
                    el.className = `shrink-0 ml-0.5 text-[9px] font-bold border px-0.5 rounded whitespace-nowrap ${finalColorClass}`;
                    el.classList.remove('hidden');
                }
            }
        }

        function saveExtraSettings() {
            const p = document.getElementById('skill-percent');
            const h = document.getElementById('skill-hit');
            if(p) extraSettings.skillPercent = Number(p.value) || 100;
            if(h) extraSettings.skillHit = Number(h.value) || 1;
            localStorage.setItem('myExtraSettings', JSON.stringify(extraSettings));
            calculate();
        }

        function updateBase(key, value) {
            baseStats[key] = Number(value);
            localStorage.setItem('myBaseStats_v3', JSON.stringify(baseStats));
            calculate();
        }

        function updateItem(type, key, value) {
            const val = Number(value);
            if (type === 'A') itemA[key] = val;
            else itemB[key] = val;

            if (type === 'B' || type === 'A') {
                const diffEl = document.getElementById(`diff-tag-${key}`);
                if (diffEl) {
                    const valA = itemA[key] || 0;
                    const valB = itemB[key] || 0;
                    const diff = valB - valA;
                    
                    if (diff > 0) {
                        diffEl.innerText = `(+${diff})`;
                        diffEl.className = "diff-tag diff-plus";
                    } else if (diff < 0) {
                        diffEl.innerText = `(${diff})`;
                        diffEl.className = "diff-tag diff-minus";
                    } else {
                        diffEl.innerText = "";
                    }
                }
            }
            calculate();
        }

        function resetItem(type) {
            if (type === 'A') itemA = {}; else itemB = {};
            fields.forEach(f => {
                const el = document.getElementById(`input-${type}-${f.key}`);
                if(el) el.value = ''; 
                const diffEl = document.getElementById(`diff-tag-${f.key}`);
                if(diffEl) diffEl.innerText = "";
            });
            calculate();
        }

        function resetAllData() {
            if(confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { 
                localStorage.removeItem('myBaseStats_v3'); 
                localStorage.removeItem('myExtraSettings');
                location.reload(); 
            }
        }

        function formatNumber(num) {
            if (num === 0) return "0";
            if (num >= 100000000) return (num / 100000000).toFixed(2) + "ì–µ";
            if (num >= 10000) return (num / 10000).toFixed(0) + "ë§Œ";
            return Math.floor(num).toLocaleString();
        }

        function calculate() {
            const baseSkillPer = extraSettings.skillPercent || 100;
            const skillHit = extraSettings.skillHit || 1;

            analyzeEfficiency(baseStats);

            const cur = getSimpleDpm(baseStats);
            const simStats = {};
            fields.forEach(f => {
                simStats[f.key] = (baseStats[f.key]||0) - (itemA[f.key]||0) + (itemB[f.key]||0);
                if (simStats[f.key] < 0) simStats[f.key] = 0; 
            });
            const next = getSimpleDpm(simStats);
            
            updateDisplay('res-normal', cur.normal, next.normal, cur.rawNormal, next.rawNormal);
            updateDisplay('res-boss', cur.boss, next.boss, cur.rawBoss, next.rawBoss);
        }

        function updateDisplay(id, curScore, nextScore, rawPrev, rawNext) {
            const el = document.getElementById(id + '-diff');
            const diff = curScore === 0 ? 0 : ((nextScore - curScore) / curScore) * 100;
            const sign = diff > 0 ? "+" : "";
            
            if(el) {
                el.innerText = `${sign}${diff.toFixed(2)}%`;
                el.className = `text-5xl font-mono font-bold my-2 ${diff > 0 ? 'text-green-400 drop-shadow' : (diff < 0 ? 'text-red-500' : 'text-gray-500')}`;
            }

            const prevEl = document.getElementById(id + '-prev');
            const nextEl = document.getElementById(id + '-next');
            if(prevEl) prevEl.innerText = formatNumber(rawPrev);
            if(nextEl) nextEl.innerText = formatNumber(rawNext);
        }

        renderInputs();
        calculate();
        loadSystemInfo();
    </script>
    
    <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="zico24820b" data-description="Support me on Buy me a coffee!" data-message="ìœ ìš©í•˜ì…¨ë‹¤ë©´ ì»¤í”¼ í•œ ì” ë¶€íƒë“œë ¤ìš”!" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
</body>
</html>